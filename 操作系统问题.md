# 操作系统问题

## 1、如何进行进程通信？（百度）（字节）（shopee）（腾讯）

**1、共享存储：**两个进程通过对一块共享空 间的访问实现通信。各进程对共享空间的访问是互斥的。又可以细分为**基于数据结构**（共享空间放一个长度为10的数组，这种共享方式比较慢，是一种低级的通信方式）、**基于存储区**（在内存中划一块共享储存区，数据的形式、存放位置都由进程控制，而不是OS，相比之下这种共享方式更快，是一种高级通信方式）。

**共享内存通信的优缺点：**可以解决消息队列通信带来的数据拷贝带来的开销问题。

**2、消息队列传递：**进程间的数据交换以格式化信息为单位，进程通过OS提供的**发送消息/接收消息**两个原语进行数据交换。**消息队列是保存在内核中的消息链表**。

1. **直接通信方式**：消息直接挂到接收进程的消息缓冲队列上
2. **间接通信方式**：消息要先发送到中间实体（信箱）中。

**消息队列通信的优缺点：**

首先解决了管道通信的不适合进程频繁通信的问题。但是它的缺点是：一，通信不及时。二，附件有大小的限制。三，通信过程中会存在着用户态与内核态之间的数据拷贝带来的开销。

**3、管道通信：**管道是指用于连接读写进程的一个共享文件，又名pipe，其实就是内存中开辟的一个大小固定的缓冲区。单管道只能进行半双工通信。Linux中管道符为 | 。

![](https://github.com/lokles/Web-Development-Interview-With-Java/blob/main/images/进程管道通信.JPG)

**管道通信的优缺点：**

管道通信的效率低，**不适合进程间频繁的交换数据**，好处是简单，我们很容易的就可以知道管道中的数据被另一个进程读取。

**4、信号量**

**5、Socket**

前面提到的管道、消息队列、共享内存、信号量和信号都是在同一台主机上进行进程间通信，那要想**跨网络与不同主机上的进程之间通信，就需要 Socket 通信了。**



## 2、页面置换算法 ？（百度）（美团）（滴滴）

现在大多数都采用了**虚拟内存技术**，所以需要页面置换算法。

什么是页面置换？在程序运行过程中，如果要访问的页面不在内存中，就发生**缺页中断（要访问的资源不存在，由用户态陷入内核态调用相关资源，是一种内中断）**从而将该页调入内存中。此时**如果内存已无空闲空间，系统必须从内存中调出一个页面到磁盘对换区中来腾出空间**。

**1、最佳置换算法（OPT）**

是一种仅存在于理论中的算法，因为无法得知哪一个页面是最长时间没有被访问的。

**2、先进先出置换算法（FIFO）**

把调入内存的页面根据调入的先后顺序排成一个队列，队列的大小为OS为进程分配的多少个内存块。需要置换的时候将第一个进入队列的页调出。**该算法并不符合实际的运行规律。**

**3、最近最久未使用置换算法（LRU）**

每次淘汰的是**最近最久未使用的页面**。页表中用**访问字段**记录该页面自上次访问以来所经历的时间t，当需要淘汰一个页面时，选择现有页中t值最大的。

**算法性能较好，但是开销较大**

**4、时钟置换算法（CLOCK）**

**实现过程：**

1. 为页面设置一个**访问位**，然后将内存中的页面通过指针连结成一个**循环队列**。
2. 当某个页被访问时，访问位置1。当需要淘汰一个页时，只需要检查访问位，0则换出；如果是1则置0，暂不换出，继续检查下一个页面访问位。最多经过两轮检查会找到一个淘汰页面。

时钟置换算法是一种**兼顾性能与开销**的算法。

## 3、进程的内核态和用户态？（百度）（网易）

为了维护OS安全，设置了**特权级**概念。运行于不同特权级的进程所拥有的权限也不同。大部分进程都是运行在用户态的。只有当需要完成一些自己本身权限无法完成的业务时，会通过**系统调用**切换到内核态来让操作系统帮忙执行。

## 4、进程调度算法？（腾讯）

为什么需要进程调度？由于cpu资源的有限性，导致需要一套完整的算法来对进程做一个管理。

1、 非抢占式调度算法：

1. **先来先服务（FCFS，first come first served）**：进程按照它们请求CPU的顺序使用CPU.就像你买东西去排队，**谁第一个排，谁就先被执行，在它执行的过程中，不会中断它**。当其他人也想进入内存被执行，就要排队等着，如果在执行过程中出现一些事，他现在不想排队了，下一个排队的就补上。此时如果他又想排队了，只能站到队尾去
2. **最短作业优先 （SJF, Shortest Job First）**：对预计执行时间短的进程优先分派处理机。通常后来的短进程不抢先正在执行的进程。相比FCFS 算法，该算法可改善平均周转时间和平均带权周转时间，缩短进程的等待时间，提高系统的吞吐量。对于长进程不利，**可能会导致长进程的饥饿**。

2、抢占式调度算法：

1. **最短剩余时间优先** ：是最短作业优先的抢占版本，按照剩余运行时间进行调度。当一个新作业到达时，其整个的运行时间与当前运行进程的剩余时间对比。如果新的进程所需时间更少会将当前运行进程挂起，运行新的进程。

2. **时间片轮转算法（RR，Round-Robin）**：每个进程被分配一个时间段，称作它的时间片，即该进程允许运行的时间。**让就绪进程以FCFS 的方式按时间片轮流使用CPU 的调度方式**，即将系统中所有的就绪进程按照FCFS 原则，排成一个队列，每次调度时将CPU 分派给队首进程，让其执行一个时间片，时间片的长度从几个`ms` 到几百`ms`。在一个时间片结束时，发生时钟中断，调度程序据此暂停当前进程的执行，将其送到就绪队列的末尾，并通过上下文切换执行当前的队首进程，进程可以未使用完一个时间片，就出让CPU（如阻塞）。

3. **多级反馈队列(Multilevel Feedback Queue)** ：如果一个进程需要执行100个时间片，如果采用时间片轮转算法则需要交换100次，**多级队列专门为了这种需要连续执行多个时间片的进程考虑**。它设置多个队列。每个队列时间片的大小也不相同。假设现在有四个队列。时间片分别为 1、2、4、8那么一个需要100时间片的进程仅需要交换7次（100/（1+2+4+8）= 7）。

   进程在队列1中执行结束后进入队列2.....依次直到进程耗尽时间片。最上面的队列优先级最高，只有当上一个队列没有进程排队，才能调度当前队列的进程。

![](https://github.com/lokles/Web-Development-Interview-With-Java/blob/main/images/1595850316585.png)

## 5、LFU的设计？（腾讯）



## 7、如何实现进程同步？（字节）

什么是进程同步？多个进程按照一定的顺序执行。

1. 信号量机制
2. 管程

## 8、什么是死锁？（美团）（跟谁学）（滴滴）（百度）

多个进程在运行过程中因资源争夺而造成的一种僵局。

## 9、死锁的必要条件？

- 互斥：被争夺的资源要么分配给了一个进程要么就是可用的
- 请求与保持：已经得到资源的进程依旧可以申请新资源
- 不可抢占：已经分配的资源不可以强制性的被抢占，只能被拥有者显式释放
- 环路等待：有两个或以上的进程形成一条环路。

## 10、如何处理死锁？ （美团）（跟谁学）（滴滴）（百度）

1. 鸵鸟策略：假装没有发生死锁
2. 死锁检测与死锁恢复
3. 死锁预防：破坏死锁产生的必要条件，破坏互斥条件、不可抢占条件、环路等待条件。
4. 死锁避免：在程序运行时避免发生死锁。

## 11、什么是虚拟内存？（腾讯）

对于一些很大的程序，将很快需要用到的**页**装入内存，当需要访问的页不在内存时再由OS外存调入（依据页面置换算法）。当内存吃紧时，再由OS将内存中暂时不用的信息换出到外存。这就是虚拟内存技术。

## 12、什么是上下文切换？（美团）

将CPU资源从一个进程分配到另一个进程的机制。在切换的过程中，操作系统需要先存储当前进程的状态(包括内存空间的指针，当前执行完的指令等等)，再读入下一个进程的状态，然后执行此进程。

## 13、为什么进程上下文切换的代价比线程上下文切换高？（美团）

进程切换分两步：

1. **切换页目录**以使用新的地址空间
2. 切换内核栈和硬件上下文

线程切换不需要切换页目录。

## 14、时间片概念？（百度）

是时分操作系统分配给每个正在运行的进程微观上的一段CPU时间。

## 15、段、页式存储？

- **分页存储：**将内存空间分成的一个个大小相等的分区，每一个页有自己的编号，页框不能设置太大，否则会产生内部碎片。不方便按照逻辑模块实现信息的共享。
- **分段存储：**信息的逻辑单位，很方便的按照逻辑模块实现信息的共享，缺点是可能会由于段长度过大导致

## 16、内存管理方式？

物理内存管理：

- 包括程序装入等概念、交换技术、连续分配管理方式和非连续分配管理方式（分页、分段、段页式）。

虚拟内存管理：

- 虚拟内存管理包括虚拟内存概念、请求分页管理方式、页面置换算法、页面分配策略、工作集和抖动。
